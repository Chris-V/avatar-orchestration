- name: Copy NFTables configuration
  template:
    src: "etc/nftables.conf.j2"
    dest: "/etc/nftables.conf"
    force: yes
    owner: "root"
    group: "root"
    mode: 0600
    validate: "nft -c -f %s"
  notify: reload nftables

- name: Enable NFTables
  systemd:
    name: "nftables.service"
    state: "started"
    enabled: yes

- name: Update hosts file
  lineinfile:
    state: "present"
    path: "/etc/hosts"
    create: no
    line: "{{ item.ip }} {{ item.hostname }}"
  loop:
    - { ip: "{{ living_room_tv_ip }}", hostname: "tv-lr.devices.local" }
    - { ip: "{{ living_room_home_ip }}", hostname: "home-lr.devices.local" }
    - { ip: "{{ lounge_cast_ip }}", hostname: "cast-lounge.devices.local" }
    - { ip: "{{ lounge_home_ip }}", hostname: "home-lounge.devices.local" }
    - { ip: "{{ lounge_broadlink_ip }}", hostname: "broadlink-lounge.devices.local" }
    - { ip: "{{ laundry_home_ip }}", hostname: "home-laundry.devices.local" }
    - { ip: "{{ master_bedroom_home_ip }}", hostname: "home-mbr.devices.local" }
