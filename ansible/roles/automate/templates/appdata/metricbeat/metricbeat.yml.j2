name: "{{ inventory_hostname }}"

setup:
  dashboards.enabled: false
  template:
    enabled: true
    overwrite: true
    settings.index:
      number_of_shards: 1
      number_of_replicas: 0
  ilm:
    enabled: true
    check_exists: false
    overwrite: false
    policy_name: avatar-metrics
    rollover_alias: "metricbeat-{{ elastic.hosts[inventory_hostname].username }}-7.2.0"
    pattern: "000001"

logging:
  level: "warning"
  to_files: false
  metrics.enabled: false

output.elasticsearch:
  hosts: "{{ elastic.hostname }}"
  username: "{{ elastic.hosts[inventory_hostname].username }}"
  password: "{{ elastic.hosts[inventory_hostname].password }}"

metricbeat.modules:
  - module: system
    enabled: true
    period: 1m
    metricsets:
      - "cpu"
      - "core"
      - "diskio"
      - "load"
      - "memory"
      - "network"
      - "process"
      - "process_summary"
    cpu.metrics:  ["percentages"]
    core.metrics:  ["percentages"]
    process.cgroups.enabled: false
    process.include_top_n:
      enabled: true
      by_cpu: 10
      by_memory: 10

  - module: system
    period: 15m
    metricsets:
      - "filesystem"
      - "fsstat"
      - "uptime"
    processors:
      - drop_event.when.regexp:
          system.filesystem.mount_point: '^/(sys|cgroup|proc|dev|etc|host|lib)($|/)'

  - module: docker
    enabled: true
    period: 1m
    metricsets:
      - "container"
      - "cpu"
      - "diskio"
      - "healthcheck"
      - "info"
      - "memory"
      - "network"
    hosts: ["unix:///var/run/docker.sock"]
