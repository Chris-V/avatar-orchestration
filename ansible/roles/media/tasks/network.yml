- name: Install ethernet tools
  pacman:
    name: ethtool
    state: present

- name: Activate WOL
  command: "ethtool -s {{ ansible_facts['default_ipv4']['interface'] }} wol g"

- name: Copy WOL config
  template:
    src: etc/systemd/network/15-wired.link.j2
    dest: /etc/systemd/network/15-wired.link
    force: yes
    owner: root
    group: root
    mode: 0644

- name: Copy NFTables configuration
  template:
    src: etc/nftables.conf.j2
    dest: /etc/nftables.conf
    force: yes
    owner: root
    group: root
    mode: 0600
    validate: 'nft -c -f %s'
#  notify: reload nftables

# TODO: Doesn't work with docker. Fix and enable.
- name: Enable NFTables
  systemd:
    name: nftables.service
    state: stopped #started
    enabled: no #yes
